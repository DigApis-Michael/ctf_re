# 栈
## 栈是计算机控制过程调用和返回的常用技术。
- 栈指针：栈顶地址。当发生push或者pop操作时，这个指针会加1或者减1，以表示最新的栈顶指针；
- 栈底：保存栈底单元的地址。当对空栈发生pop操作时，则发生错误；
- 栈界限：保存最顶端栈单元的地址。当对满栈发生push操作时，则发生错误；
- 注：栈的“底”实际上使用的是整个栈的最低地址，即是整个栈的启始内存地址。

# 过程调用和返回，栈针
- 当处理器处理一个过程调用时，它将返回地址放在栈中。当过程调用执行返回时，就会使用该栈顶地址。
## 除了返回地址，过程调用还需要传递参数
- 1.如果直接将参数传递到寄存器中，那么调用程序和被调用程序都需要被写入寄存器；
- 2.将参数保存在存储器的call指令之后，但是对于可变参数的处理会很困难；
- 3.最好的方法就是使用栈。当处理器执行一次过程调用的时候，不仅会保存返回地址，还会保存传递给被调用过程的参数。被调用过程会从栈中访问这些参数，在返回前，返回参数也可以放在栈中返回地址的下面。为一次过程调用保存的整个参数集合和返回地址，就称为一个栈帧；
![如图](https://images0.cnblogs.com/blog/400807/201411/191152583125010.png)

# 参数的传递
1. 被调用方函数（Callee functiongs)通过栈指针获取其所需的参数
2. 在运行f()函数之前，传递给他的参数将以以下格式存储到内存里：
3. 如下
---------------------------------
ESP	     |返回地址
---------------------------------
ESP+4	   |arg1,它在IDA里面记为arg0
ESP+8	   |arg2,它在IDA里面记为arg4
ESP+0xC	 |arg4,它在IDA里面记为arg8

# 典型的栈的内存存储格式
------------------------------------------------
ESP-0xC	 |  第 2 个局部变量,在 IDA 里记为 var_8
ESP-8	   |第 1 个局部变量,在 IDA 里记为 var_4
ESP-4	   |保存的 EBP 值
ESP	     |返回地址
ESP+4	   |arg1, 在 IDA 里记为 arg_0
ESP+8	   |arg2, 在 IDA 里记为 arg_4
ESP+0xC	 |arg3, 在 IDA 里记为 arg_8

# 参考
- [1](http://blog.csdn.net/ysxiaoer/article/details/8095298)
- [2](https://github.com/DigApis-Michael/ctf_re/blob/master/tutorials/171213_7th.md)
